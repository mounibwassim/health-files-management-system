# HealthFiles Manager System (Enterprise Edition)

A robust, cloud-native application designed to digitize and manage health records across 60 Wilayas (States) in Algeria. This system provides strict Role-Based Access Control (RBAC), Arabic language support, and automated reporting.

---

## üöÄ Key Enterprise Features (New)

### 1. Strict Role-Based Access Control (RBAC)
- **Admin View**: Full visibility of all records across the organization. Includes a "Created By" column to audit employee activity.
- **Employee View**: Strictly isolated environment. Employees can ONLY see and manage records they personally created.
- **Smart Summary**: Dashboards dynamically adapt to show "Total Records" (Global) vs "My Records" (Personal).

### 2. Advanced PDF Reporting
- **Arabic Language Support**: Integrated **Amiri** font engine to correctly render Arabic names and text in PDF reports.
- **Smart Color Coding**: 
    - **Green**: Completed tasks.
    - **Red**: Incomplete/Pending tasks.
- **Chain of Custody**: Reports include a guaranteed "Generated by: [Username]" header for accountability.

### 3. "Download Full Wilaya" Utility
- **One-Click Export**: Administrators can download an entire Wilaya's dataset in a single click.
- **Automated Packaging**: The system asynchronously fetches Surgery, IVF, Ophthalmology, and Lab records, generates 4 separate PDFs, and zips them into a structured folder.

### 4. Security & Polish
- **Hash-Only Passwords**: Secure `bcrypt` hashing for all credentials.
- **No-Reset Policy**: strict security model where passwords cannot be reset by users, only by Admins via explicit intervention.
- **Visual Excellence**: Dark Mode, Glassmorphism UI, and animated transitions.

---

## üèóÔ∏è Architecture

### Frontend (The User Interface)
- **Tech**: React.js 18, Vite, Tailwind CSS, Headless UI.
- **Logic**: 
  - **SPA Routing**: Client-side routing for instant page loads.
  - **PDF Engine**: Custom `jspdf` + `jspdf-autotable` integration with VFS (Virtual File System) for font injection.
  - **Dual API Strategy**: Handles local development and production endpoints seamlessly.

### Backend (The Core)
- **Tech**: Node.js, Express, PostgreSQL.
- **Logic**:
  - **JWT Authentication**: Stateless, secure token-based auth.
  - **Correlated Subqueries**: Optimized SQL for accurate real-time counting of nested records.
  - **Strict Middleware**: Custom middleware strictly enforces data isolation policies at the database query level.

---

## üõ†Ô∏è Project Setup

### Prerequisites
*   Node.js (v18+)
*   PostgreSQL

### 1. Backend Setup
```bash
cd backend
npm install
# Create .env with DATABASE_URL and JWT_SECRET
node server.js
```

### 2. Frontend Setup
```bash
cd frontend
npm install
npm run dev
```

---

## üîí Security Model
- **Data Isolation**: A user cannot access another user's records, even via direct API calls (enforced by `WHERE user_id = ?` clause).
- **Admin Override**: Only users with `role: 'admin'` bypass isolation filters.
- **Audit Trails**: Every PDF download and record creation is stamped with the actor's identity.
